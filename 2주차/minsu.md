# JSX

- Javascript Syntax eXtension / JavaScript XML
  - 컴파일러/트랜스파일러에 의해 일반 JS 코드로 변환되는 확장 구문
- 장점
  - 더 쉬운 읽기 및 쓰기
  - 향상된 보안
  - 강력한 타이핑
  - 컴포넌트 기반 아키텍쳐
  - 광범위한 사용
- 약점
  - 학습 곡선 가중
  - 전용 도구 필요
  - 관심사 혼합
  - 자바스크립트 호환성 부족
- 자바스크립트 컴파일러
  - 토큰화
  - 구문 분석
  - 코드 생성
- JSX 프라그마
  - React.createElement 대신 < 문자를 사용하는 별칭에 불과
- 표현식은 평가되지만 문장은 평가되지 않음

# 가상 DOM

- 실제 DOM 관리는 복잡하고 오류가 발생하기 쉬운 작업
- HTML 문서를 JS 객체로 모델링한 것
- 실제 DOM 조작 방식
  - document.querySelector는 크고 복잡한 문서를 작업할 때 속도가 느려진다는 문제 잠재 (검색 속도) + 선택자 평가 및 유효성 검사 필요
  - document.getElementById는 유효성 검사가 필요없고 특정성이 높아 효율적이지만 한 페이지 내에서 여러 번 재사용되는 컴포넌트에는 적합하지 않음 (id unique)
- 실제 DOM의 문제점
  - 성능
    - CPU 효율성 우선의 필요성
  - 브라우저 간 호환성
  - 보안 취약성
    - 크로스 사이트 스크립팅 (XSS)
- 문서 조각
  - DOM 노드를 저장하는 가벼운 컨테이너
  - document.createDocumentFragment()
  - 성능 이점
    - 일괄 업데이트
    - 메모리 효율성
    - 중복 렌더링 방지
- 가상 DOM 작동 방식
  - 페이지의 레이아웃을 다시 계산하고 엘리먼트를 다시 그리는 작업을 브라우저에서 수행하지 않고도 더 효율적이고 성능이 뛰어난 방식으로 실제 DOM 업데이트 가능
  - 리액트 엘리먼트
    - `$$typeof`: 객체가 유효한 리액트 엘리먼트인지 확인할 때 사용하는 특수한 symbol
      - 리액트 엘리먼트의 종류를 식별하는 표시자 역할
    - type: 엘리먼트가 나타내는 컴포넌트의 종류를 알려줌
    - ref: 부모 컴포넌트는 이 속성을 사용해 기본 DOM 노드에 대한 참조 요청 가능 (DOM 직접 조작할 때 보통 사용)
    - props: 컴포넌트에 전달된 모든 속성과 프롭을 포함하는 객체
    - \_owner: 프로덕션 빌드가 아닐 때만 접근 가능한 속성, 엘리먼트를 생성한 컴포넌트를 추적하기 위해 리액트 내부적으로 사용됨
    - \_store: 엘리먼트에 대한 추가 데이터를 저장하기 위해 리액트가 내부적으로 사용하는 객체
- 가상 DOM vs. 실제 DOM
  - 리액트 컴포넌트가 렌더링되면 리액트는 새 가상 DOM 트리를 생성하고 이전 가상 DOM 트리와 비교한 다음, 이전 트리를 새 트리와 일치하도록 업데이트하는 데 필요한 최소 변경 횟수 계산 => 재조정 프로세스

# 재조정

- Virtual DOM은 우리가 원하는 UI 상태의 청사진
- 일괄 처리
  - 리액트는 재조정 과정에서 여러 가상 DOM 업데이트를 모아 한번의 DOM 업데이트로 결합한 후 실제 DOM에 대한 업데이트 일괄 처리
- 스택 재조정자는 업데이트 우선순위 정하지 않음, 업데이트를 중단하거나 취소할 수 없음 -> 끊김 현상, 느린 응답 속도 문제 발생 가능
- 파이버 재조정자
  - 파이버: 조정자를 위한 작업 단위를 나타내는 데이터 구조, 리액트 엘리먼트에서 생성됨
    - 파이버는 상태를 저장하고 수명이 긴 반면 리액트 엘리먼트는 임시적이고 상태가 없음
  - 재조정에 파이버 트리 사용
  - 데이터 구조로서의 파이버
    - 파이버 노드가 생성되면 파이버 재조정자는 work loop를 사용해 UI 업데이트함
    - work loop는 루트 파이버 노드에서 시작해 컴포넌트 트리를 따라 내려가면서 업데이트가 필요한 경우 각 파이버 노드를 '더티'로 표시함
    - 끝에 도달하면 다시 반대로 순회하면서 브라우저의 DOM 트리와는 분리된 새 DOM 트리를 메모리에 생성함
  - 더블 버퍼링
    - 이미지나 프레임을 저장하기 위한 두 개의 버퍼/메모리 공간을 생성하고 일정한 간격으로 두 버퍼를 전환해 최종 이미지나 동영상 표시
  - 파이버 재조정
    - 렌더링
      - 현재 트리에서 상태 변경 이벤트가 발생하면 시작함
      - beginWork (작업 시작)
      - completeWork (작업 완료)
    - 커밋
      - 변형: 가상 DOM에 적용된 변경 사항을 실제 DOM에 반영
      - 레이아웃: DOM에서 업데이트된 노드의 새 레이아웃 계산
  - FilberRootNode: 재조정 과정의 커밋 단계를 관리하는 핵심 데이터 구조

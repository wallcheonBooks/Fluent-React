# 6장 서버 사이드 리액트

- CSR의 대표적인 라이브러리인 리액트에서 왜 갑자기 서버라는 개념이 조금씩 들어오고, 이제는 주류가 되어가고 있을까?
- 서버가 있으면 생기는 이점은 무엇일까?
- 클라이언트 사이드 렌더링의 한계가 존재한다.
- 결론적으로는 리액트 애플리케이션의 **수준**을 높여줄 수 있다고 얘기하고 있다.
  - 그러나 수준이 높아질 수 있지만, 서버를 관리해야 한다는 점이 가장 리스크라고 생각한다. SSR 인프라를 관리할 수 있는 역량이 있어야 함.

## 6.1 클라이언트 사이드 렌더링 한계

- 2013년에 리액트가 처음 오픈 소스로 공개되었을 때 이때는 CSR 방식을 적용했다.

### 6.1.1 검색 엔진 최적화(SEO)

- 검색 엔진의 크롤러가 웹 페이지에 접근했을 때 예상대로 실행되지 않을 수 있다.
- 보통 구글과 빙의 검색 엔진은 클라이언트 전용 웹사이트를 자바스크립트가 실행이 되어 DOM Tree를 구성할 때 까지 기다렸다가 색인을 할 수 있다고 알고 있지만, 그렇다고 해서 대응을 할 필요가 없는 것은 아니다.
- 우리가 알지 못하는 부분이 더 많고, SEO에 대한 해결책으로 SSR을 하는 것은 유리한 해결책이 맞기 때문에 여전히 많은 회사들에서 적용하고 있다.
- 다만 CSR을 오직 Next.js, Remix와 같은 풀스택 프레임워크를 통해서 SEO를 할 수 있는 것은 아니다. AWS의 Lambda@Edge와 같은 도구를 이용해서 SEO를 할 수 있다. 따라서 정말 필요한 것이 무엇인지에 따라서 이런 프레임워크를 도입하는 의사 결정이 필요하다고 생각한다.

### 6.1.2 성능
- CSR 방식에서 화면을 그릴 때는 네트워크 워터폴 문제가 있다. 동기적으로 계속해서 네트워크 요청을 하게 되면서 웹 서비스의 성능을 늦추게 되는 문제다. 이는 이런식의 정적 리소스를 요청하는 과정에서도 발생하며 api call을 하는 과정에서도 발생해 주의가 필요하다. 최적화를 할 때 챙겨보면 좋은 부분.
- 렌더링 차단 블록 리소스 라고 표현하기도 하는데, 이러한 것들로 인해서 CSR은 느린 네트워크나 낮은 성능 기기에서 더욱 성능 문제를 겪을 수 있다고 얘기하고 있다.
- 사용자가 처음 화면을 보는 시간이 느리면 여러면에서 손해를 볼 수 있다는 것은 많이 알려져 있는 일이다.
- 특히 CPU 가용성이 낮은 저전력 기기에서 CSR을 도입하면 더더욱 속도가 느려지게 된다.
- 자바스크립트의 역할은 웹 페이지를 보완하는 것이지, 웹 페이지 그 자체가 되는 것은 아니다 -> 사람마다 생각은 다를 수 있을 것 같다.
- CSR, SSR
  - CSR: HTML Loading -> JS Loading -> 초기 UI 렌더링 -> 데이터 가져오기 -> UI 업데이트
  - SSR: HTML Loading

### 6.1.3 보안
- CSR은 크로스 사이트 요청 위조(CSRF) 같은 공격에 취약하다.
- 서버에 접근할 수 있고, 웹사이트가 CSR 이라면 CSRF 위협을 상당히 잘 방어할 수 있다.
- 토큰을 html에 꽂아놓는 방식으로도 보안 문제를 완화할 수 있다.

## 6.2 서버 렌더링의 부상

### 6.2.1 서버 렌더링의 장점
- 최초 의미 있는 페인트(first meaningful paint는 사용자가 처음으로 의미 있는 콘텐츠를 볼 수 있는 시점)가 완성되는 시간이 더 빨라집니다.
- 접근성 개선 (속도)
- SEO 개선
- 보안 향상

## 6.3 하이드레이션
- [하이드레이션](https://18.react.dev/reference/react-dom/client/hydrateRoot#suppressing-unavoidable-hydration-mismatch-errors)
- 하이드레이션은 서버에서 생성된 HTML이 클라이언트에서 렌더링이 되었을 때 자바스크립트 파일을 다운로드 받고 실행해서 이벤트 리스너나 여러 자바스크립트 기능을 추가하는 프로세스를 의미한다.
- 클라리언트 번들 로딩, 이벤트 리스너 추가
- 하이드레이션 불일치 에러가 발생하는 이유는?
  - HTML이 DOM 엘리먼트 구조를 리액트 컴포넌트가 JSX를 사용해 정의한 구조와 일치시켜야 합니다.
  - 그래야지 이벤트 리스너를 올바르게 연결할 수 있고 어떤 엘리먼트끼리 매핑되어야 하는지 인식할 수 있다.

### 6.3.1 하이드레이션에 대한 비판
- 재개 가능성 -> Astro와 같은 느낌이 있다. (아일랜드 아키텍처)
- 조금이라도 더 빠르게 인터랙티브 할 수 있는 웹사이트를 만들기 위한 방법.

## 6.4 서버 렌더링 작성
- 프레임워크를 사용하는 게 가장 무난하지만, node 서버를 직접 구축해서도 SSR을 구현할 수 있다.

### 6.4.1 클라이언트 전용 리액트 앱에 서버 렌더링을 수동으로 추가하기
- 정말 간단하게는 renderToString 메소드를 이용해서 활용할 수 있다.
- 보통 FE들에게도 Express는 익숙하다보니 Express로 구축하는 게 일반적인 것 같은데, 성능을 위해서 fastify를 사용하는 곳도 많은 것 같다.

### 6.4.2 하이드레이션
- 리액트에서는 hydrateRoot API를 사용하면 클라이언트 사이드에서 애플리케이션을 하이드레이션 할 수 있다.
